import numpy as np
import pandas as pd
from scipy.interpolate import interp1d

def safe_interpolate(df, time_col=0, dissol_col=1):
    """Create interpolator with safe extrapolation handling"""
    times = df.iloc[:, time_col].values.astype(float)
    dissolution = df.iloc[:, dissol_col].values.astype(float)
    
    # Handle 0 explicitly if missing
    if 0 not in times:
        times = np.insert(times, 0, 0.0)
        dissolution = np.insert(dissolution, 0, 0.0)  # Assume 0% at time 0
    
    return interp1d(
        times, 
        dissolution, 
        bounds_error=False, 
        fill_value=(dissolution[0], dissolution[-1])  # Extrapolate with edge values
    )

def generate_combinations(ref_df, test_df, regulation, window_min, window_max):
    # Create interpolators with safe handling
    ref_interp = safe_interpolate(ref_df)
    test_interp = safe_interpolate(test_df)
    
    # Rest of your combination generation logic
    # ...
