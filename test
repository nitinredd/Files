def build_domain_from_df(df: pd.DataFrame, objectives: List[Dict[str, Any]]):
    """Build optimization domain from DataFrame with proper column filtering."""
    
    print(f"\n{'='*60}")
    print("BUILDING DOMAIN FROM DATAFRAME")
    print(f"{'='*60}")
    print(f"DataFrame shape: {df.shape}")
    print(f"DataFrame columns: {list(df.columns)}")
    print(f"Number of objectives: {len(objectives)}")
    
    # Normalize column names for comparison
    def normalize_col_name(name):
        return str(name).strip().replace(" ", "_").replace("(", "").replace(")", "").replace("-", "_").lower()
    
    # Get objective column names (normalized)
    objective_names = [obj.get("name", "").strip() for obj in objectives]
    objective_names_normalized = {normalize_col_name(name) for name in objective_names if name}
    
    print(f"Objective names from config: {objective_names}")
    print(f"Objective names (normalized): {objective_names_normalized}")
    
    # Get all numeric columns
    numeric_cols = df.select_dtypes(include=[np.number]).columns.tolist()
    print(f"\nNumeric columns in DataFrame: {numeric_cols}")
    
    if len(numeric_cols) == 0:
        raise ValueError("No numeric columns found in DataFrame - cannot build domain")
    
    # Separate input variables from objectives
    input_variable_cols = []
    objective_cols = []
    
    for col in numeric_cols:
        col_normalized = normalize_col_name(col)
        
        if col_normalized in objective_names_normalized:
            objective_cols.append(col)
            print(f"  Objective: {col} (normalized: {col_normalized})")
        else:
            input_variable_cols.append(col)
            print(f"  Input var: {col} (normalized: {col_normalized})")
    
    print(f"\nFinal classification:")
    print(f"  Input variables: {len(input_variable_cols)} - {input_variable_cols}")
    print(f"  Objectives: {len(objective_cols)} - {objective_cols}")
    
    if len(input_variable_cols) == 0:
        raise ValueError(
            f"No input variables identified! All {len(numeric_cols)} numeric columns are classified as objectives. "
            f"Check that objective names match DataFrame columns.\n"
            f"Numeric columns: {numeric_cols}\n"
            f"Objective names: {objective_names}"
        )
    
    # Build domain
    domain = Domain()
    
    # Add input variables with bounds from data
    print(f"\nAdding input variables to domain:")
    for col in input_variable_cols:
        # Calculate bounds from existing data
        col_data = df[col].dropna()
        
        if len(col_data) == 0:
            print(f"  WARNING: No data for column '{col}', using default bounds [0, 1]")
            lb, ub = 0.0, 1.0
        else:
            lb = float(col_data.min())
            ub = float(col_data.max())
            
            # Ensure bounds are different
            if lb == ub:
                if lb == 0:
                    lb, ub = 0.0, 1.0
                else:
                    margin = abs(lb) * 0.1
                    lb -= margin
                    ub += margin
            
            print(f"  {col:30s}: [{lb:.4f}, {ub:.4f}]")
        
        # Sanitize name for Summit (replace spaces with underscores)
        sanitized_name = str(col).replace(" ", "_").replace("(", "").replace(")", "").replace("-", "_")
        
        domain += ContinuousVariable(
            name=sanitized_name,
            description=str(col),
            bounds=[lb, ub]
        )
    
    # Add objectives
    print(f"\nAdding objectives to domain:")
    for obj in objectives:
        obj_name = obj.get("name", "obj").strip()
        maximize = bool(obj.get("maximize", False))
        
        # Sanitize objective name
        sanitized_name = obj_name.replace(" ", "_").replace("(", "").replace(")", "").replace("-", "_")
        
        print(f"  {sanitized_name:30s}: {'maximize' if maximize else 'minimize'}")
        
        domain += ContinuousVariable(
            name=sanitized_name,
            description=obj_name,
            bounds=[0, 100],
            is_objective=True,
            maximize=maximize
        )
    
    print(f"\nâœ“ Domain created successfully:")
    print(f"  Total variables: {len(domain.variables)}")
    print(f"  Input variables: {len([v for v in domain.variables if not v.is_objective])}")
    print(f"  Objectives: {len([v for v in domain.variables if v.is_objective])}")
    
    return domain
