import streamlit as st
import speech_recognition as sr
import pyttsx3

st.set_page_config(page_title="Offline Speech-to-Text + TTS", layout="centered")

st.title("Offline Speech Recognition and Text-to-Speech")

recognizer = sr.Recognizer()
engine = pyttsx3.init()

def recognize_offline():
    with sr.Microphone() as source:
        st.info("Listening... Please speak.")
        audio = recognizer.listen(source, phrase_time_limit=5)
        st.success("Processing...")

    try:
        text = recognizer.recognize_sphinx(audio)
        return text
    except sr.UnknownValueError:
        return "Sorry, could not understand audio."
    except sr.RequestError:
        return "Sphinx engine error."

if "text" not in st.session_state:
    st.session_state.text = ""

if st.button("Start Listening"):
    st.session_state.text = recognize_offline()

if st.session_state.text:
    st.subheader("Recognized Text")
    if st.button("ðŸ”Š Read Aloud"):
        engine.say(st.session_state.text)
        engine.runAndWait()
    st.text_area("Your Speech", value=st.session_state.text, height=100)
