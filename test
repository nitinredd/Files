from fastapi.responses import FileResponse

@app.get("/download-formulas", name="download_formulas")
def download_formulas():
    path = FORMULAS_EXCEL_PATH
    if not path or not os.path.exists(path):
        logger.error(f"[API] /download-formulas file not found at {path}")
        raise HTTPException(404, detail="Formulas file not found on server.")

    filename = os.path.basename(path)
    media_type = "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"

    # FileResponse handles streaming efficiently and sets correct headers
    return FileResponse(path, media_type=media_type, filename=filename)
