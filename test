
import React, { useState, useEffect } from 'react';
import { motion } from 'framer-motion';

export default function SidebarHistory({ history = [], onSelect }) {
  const [open, setOpen] = useState(
    localStorage.getItem('sidebarHistoryOpen') === 'true' || false
  );

  useEffect(() => {
    localStorage.setItem('sidebarHistoryOpen', open);
  }, [open]);

  return (
    <>
      {/* Toggle Button - Completely fixed to viewport */}
      <button
        onClick={() => setOpen((prev) => !prev)}
        className="fixed hover:scale-105 active:scale-95 transition-transform"
        style={{
          position: 'fixed',
          top: '4rem',
          left: '1rem',
          zIndex: 40,
          padding: '0.4rem 0.8rem',
          borderRadius: '20px',
          backgroundColor: 'rgba(200, 150, 255, 0.3)',
          color: '#6b4d9b',
          boxShadow: '0px 2px 6px rgba(0, 0, 0, 0.1)',
          cursor: 'pointer',
          fontSize: '0.75rem',
          fontWeight: '500',
          border: open ? '1px solid rgba(200, 150, 255, 0.5)' : '1px solid rgba(220, 190, 255, 0.5)',
        }}
        title="Toggle Conversations"
      >
        {open ? 'Hide' : 'Conversations'}
      </button>

      {/* Sidebar Content */}
      <motion.div
        initial={{ opacity: 0, y: -8 }}
        animate={{ opacity: open ? 1 : 0, y: open ? 0 : -8 }}
        transition={{ duration: 0.3 }}
        style={{
          position: 'fixed',
          top: '7rem',
          left: '1rem',
          zIndex: 40,
          display: open ? 'block' : 'none',
          width: '16rem',
          background: '#ffffff',
          border: '1px solid #e3e3e3',
          borderRadius: '12px',
          boxShadow: '0px 6px 14px rgba(0, 0, 0, 0.08)',
          padding: '1rem',
          overflow: 'hidden',
        }}
      >
          <h4
            style={{
              fontSize: '1rem',
              fontWeight: '600',
              color: '#333333',
              marginBottom: '0.8rem',
            }}
          >
            Conversations
          </h4>
          <div
            style={{
              maxHeight: '50vh',
              overflowY: 'auto',
              display: 'flex',
              flexDirection: 'column',
              gap: '0.7rem',
            }}
          >
            {history.length === 0 ? (
              <div style={{ fontSize: '0.85rem', color: '#666666' }}>
                No conversations yet.
              </div>
            ) : (
              history.map((h, i) => (
                <div
                  key={i}
                  style={{
                    padding: '0.7rem',
                    borderRadius: '8px',
                    border: '1px solid #e3e3e3',
                    cursor: 'pointer',
                    backgroundColor: '#fcfcfc', // Slightly off-white for subtle texture
                    transition: 'box-shadow 0.3s ease',
                  }}
                  className="hover:shadow-md"
                  onClick={() => onSelect(h)}
                >
                  <div style={{ fontSize: '0.85rem', fontWeight: '600', color: '#333333' }}>
                    {h.title}
                  </div>
                  <div
                    style={{
                      fontSize: '0.75rem',
                      color: '#787878',
                      marginTop: '0.5rem',
                      lineHeight: '1.3',
                      whiteSpace: 'nowrap',
                      overflow: 'hidden',
                      textOverflow: 'ellipsis',
                    }}
                  >
                    {h.content}
                  </div>
                </div>
              ))
            )}
          </div>
        </motion.div>
    </>
  );
}
