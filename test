import numpy as np
from scipy.interpolate import interp1d

def create_safe_interpolator(df, time_col=0, dissol_col=1):
    """Create interpolator with guaranteed 0-handling and safe extrapolation"""
    # Extract data
    times = df.iloc[:, time_col].values.astype(float)
    dissolution = df.iloc[:, dissol_col].values.astype(float)
    
    # Add time=0 if missing (pharmaceutical standard assumption)
    if 0 not in times:
        times = np.insert(times, 0, 0.0)
        dissolution = np.insert(dissolution, 0, 0.0)  # 0% dissolution at time 0
    
    # Create interpolator with linear extrapolation
    return interp1d(
        times,
        dissolution,
        kind='linear',
        bounds_error=False,
        fill_value=(dissolution[0], dissolution[-1])  # Extrapolate with edge values
    )

# Usage in your code
ref_interp = create_safe_interpolator(reference_df)
test_interp = create_safe_interpolator(test_df)
