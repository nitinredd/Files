# ... existing FDA analysis code ...

else:
    print("\nWarning: Neither 'Both >= 85' nor 'Either >= 85' criteria are met.")
    print("Performing f2 calculations anyway for reference:")
    print("\nResults using Both >= 85 criteria:")
    changed_data_both85_f2s(reference_df, test_df)
    print("\nResults using Either >= 85 criteria:")
    changed_data_either85_FDA_f2s(reference_df, test_df)

else:
    print("Error: Time points between test and reference datasets do not match.")
    print("Calculations cannot be performed.")

# ======== ADD NEW CODE HERE ========
# Add this RIGHT BEFORE R_Regulation(file_path)

# Robust combination analysis
try:
    regulation_map = {
        1: "FDA",
        2: "EMA", 
        3: "China",
        4: "ASEAN",
        5: "ANVISA"
    }
    
    if check_same_time_points(reference_df, test_df):
        print("\n\n=== STARTING COMPREHENSIVE COMBINATION ANALYSIS ===")
        combo_results = analyze_combinations(
            reference_df.copy(),
            test_df.copy(),
            regulation_map.get(input1, "FDA")
        )
        display_results(combo_results, regulation_map.get(input1, "FDA"))
    else:
        print("\n‚ö†Ô∏è Combination analysis skipped: Time points mismatch")
        
except Exception as e:
    print(f"\nüö® Combination analysis failed: {str(e)}")
    import traceback
    traceback.print_exc()

# Keep this existing R call below
R_Regulation(file_path)
