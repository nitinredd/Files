import streamlit as st
from PIL import Image
import base64
import io

def optimize_image(image: Image.Image, max_size=(800, 800), quality=85):
    """Optimize the image by resizing and compressing."""
    image.thumbnail(max_size)
    buffer = io.BytesIO()
    image.save(buffer, format="JPEG", quality=quality)
    buffer.seek(0)
    return buffer

def image_to_base64(image: Image.Image):
    """Convert image to base64 string."""
    optimized_image = optimize_image(image)
    encoded_string = base64.b64encode(optimized_image.read()).decode("utf-8")
    return f"data:image/jpeg;base64,{encoded_string}"

def display_image_from_base64(base64_string):
    """Display image from base64 string."""
    st.image(base64_string, caption="Uploaded Image", use_column_width=True)

def main():
    st.title("Image to Base64 Converter")

    uploaded_file = st.file_uploader("Choose an image...", type=["jpg", "jpeg", "png"])
    if uploaded_file is not None:
        image = Image.open(uploaded_file)
        base64_string = image_to_base64(image)
        display_image_from_base64(base64_string)
        st.write("Base64 String:")
        st.text_area("Base64 Output", base64_string, height=300)

if __name__ == "__main__":
    main()
