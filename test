class GeminiAgent(Agent):
    def __init__(self, model, safety_settings):
        super().__init__("GeminiAgent")
        self.model = model
        self.safety = safety_settings

    def handle(self, query: str, context: dict[str, pd.DataFrame]):
        # Build single‚Äêturn prompt
        prompt = (
            "You are a domain assistant.\n"
            f"User query: {query}\n"
            + "".join(
                f"\nSheet: {sheet}\nRows:\n{df.to_csv(index=False)}\n"
                for sheet, df in context.items()
            )
        )

        # Start a chat session
        chat = self.model.start_chat(safety_settings=self.safety)
        # Send the prompt & get back a ChatMessage with .text
        reply = chat.send_message(prompt)
        return reply.text.strip()
