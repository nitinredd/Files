from PIL import Image
import base64
import io
import streamlit as st

def convert_image_to_base64(image: Image.Image):
    """Convert an image to base64-encoded string."""
    # Convert image to 'RGB' mode if it's in 'P' or 'RGBA'
    if image.mode in ["P", "RGBA"]:
        image = image.convert("RGB")
    
    # Optimize image by resizing
    image.thumbnail((800, 800))
    
    # Save the image to a BytesIO object
    buffered = io.BytesIO()
    image.save(buffered, format="JPEG", quality=85)
    buffered.seek(0)
    
    # Encode the image to base64
    img_str = base64.b64encode(buffered.read()).decode("utf-8")
    return f"data:image/jpeg;base64,{img_str}"

def main():
    st.title("Image to Base64 Converter")

    uploaded_file = st.file_uploader("Choose an image...", type=["jpg", "jpeg", "png"])
    if uploaded_file is not None:
        image = Image.open(uploaded_file)
        base64_string = convert_image_to_base64(image)
        
        st.image(base64_string, caption="Optimized Image", use_column_width=True)
        st.write("Base64 String:")
        st.text_area("Base64 Output", base64_string, height=300)

if __name__ == "__main__":
    main()
